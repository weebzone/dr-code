{
    "variables": {
      "do_api_token": "{{env `DIGITALOCEAN_API_TOKEN`}}",
      "image_name": "code-server-20-04-{{timestamp}}",
      "apt_packages": "apt-transport-https ca-certificates curl jq linux-image-extra-virtual software-properties-common ",
      "application_name": "code-server",
      "application_version": "4.0.2",
      "docker_compose_version": "1.29.2"
    },
    "sensitive-variables": ["do_api_token"],
    "builders": [
      {
        "type": "digitalocean",
        "api_token": "{{user `do_api_token`}}",
        "image": "ubuntu-20-04-x64",
        "region": "nyc3",
        "size": "s-1vcpu-1gb",
        "ssh_username": "root",
        "snapshot_name": "{{user `image_name`}}"
      }
    ],
    "provisioners": [
      {
        "type": "shell",
        "inline": ["cloud-init status --wait"]
      },
      {
        "type": "file",
        "source": "files/var/",
        "destination": "/var/"
      },
      {
        "type": "file",
        "source": "files/etc/",
        "destination": "/etc/"
      },
      {
        "type": "shell",
        "environment_vars": [
          "DEBIAN_FRONTEND=noninteractive",
          "LC_ALL=C",
          "LANG=en_US.UTF-8",
          "LC_CTYPE=en_US.UTF-8"
        ],
        "inline": [
          "apt -qqy update",
          "apt -qqy -o Dpkg::Options::='--force-confdef' -o Dpkg::Options::='--force-confold' full-upgrade",
          "apt -qqy -o Dpkg::Options::='--force-confdef' -o Dpkg::Options::='--force-confold' install {{user `apt_packages`}}",
          "apt-get -qqy clean"
        ]
      },
      {
        "type": "shell",
        "environment_vars": [
          "application_name={{user `application_name`}}",
          "application_version={{user `application_version`}}",
          "docker_compose_version={{user `docker_compose_version`}}",
          "DEBIAN_FRONTEND=noninteractive",
          "LC_ALL=C",
          "LANG=en_US.UTF-8",
          "LC_CTYPE=en_US.UTF-8"
        ],
        "scripts": [
          "files/scripts/010-code-server.sh",
          "files/scripts/011-caddy.sh",
          "files/scripts/012-grub-opts.sh",
          "files/scripts/013-ufw.sh",
          "files/scripts/899-application-tag.sh",
          "files/scripts/900-cleanup.sh"
        ]
      }
    ]
  }
  